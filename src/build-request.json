{
  "kind": "build_request",
  "title": "Add Google Analytics (gtag.js) tracking to WishMint AI",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-62",
      "text": "Add the provided Google Analytics gtag.js tracking snippet to the site HTML so it loads on every page view, using measurement ID G-ZPB7R21LJ4.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Add Google analytical tracking Script to my website <!-- Google tag (gtag.js) -->\n<script async src=\"https://www.googletagmanager.com/gtag/js?id=G-ZPB7R21LJ4\"></script>\n<script>\n  window.dataLayer = window.dataLayer || [];\n  function gtag(){dataLayer.push(arguments);}\n  gtag('js', new Date());\n\n  gtag('config', 'G-ZPB7R21LJ4');\n</script>"
        ]
      },
      "acceptanceCriteria": [
        "The built appâ€™s delivered HTML includes the exact Google tag (gtag.js) snippet with measurement ID G-ZPB7R21LJ4.",
        "On a fresh load, the browser requests https://www.googletagmanager.com/gtag/js?id=G-ZPB7R21LJ4 successfully.",
        "After page load, window.dataLayer exists and window.gtag is defined (or equivalent gtag function behavior is present)."
      ]
    },
    {
      "id": "REQ-63",
      "text": "Update the deployed frontend Content Security Policy (CSP) configuration to allow loading and using Google Analytics resources required by gtag.js, without breaking existing Internet Identity and app functionality.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Add Google analytical tracking Script to my website <!-- Google tag (gtag.js) -->\n<script async src=\"https://www.googletagmanager.com/gtag/js?id=G-ZPB7R21LJ4\"></script>\n<script>\n  window.dataLayer = window.dataLayer || [];\n  function gtag(){dataLayer.push(arguments);}\n  gtag('js', new Date());\n\n  gtag('config', 'G-ZPB7R21LJ4');\n</script>"
        ]
      },
      "acceptanceCriteria": [
        "With CSP enabled in production, the GA script loads without CSP violations in the browser console.",
        "Network requests needed by Google Analytics measurement (initiated by gtag.js) are not blocked by CSP.",
        "Existing authentication (Internet Identity) and app API calls remain functional after the CSP change."
      ]
    }
  ],
  "constraints": [
    "Frontend immutable paths must not be edited (frontend/src/hooks/useInternetIdentity.ts, frontend/src/hooks/useInternetIdentity.tsx, frontend/src/hooks/useActor.ts, frontend/src/main.tsx, frontend/src/components/ui).",
    "Keep all user-facing text in English (no new non-English UI copy introduced as part of this change)."
  ],
  "nonGoals": [
    "Building an analytics dashboard or reporting UI inside the app.",
    "Adding cookie consent banners or privacy UX changes (unless separately requested).",
    "Adding any non-Google third-party tracking scripts."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}