{
  "kind": "build_request",
  "title": "Change Upgrade behavior to open in-app modal instead of payment page",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-94",
      "text": "Change all upgrade entry points (e.g., “Upgrade to Pro”, “Upgrade to Creator”, “Unlock Premium”, and any “Upgrade Plan” button) so that clicking them only opens the in-app PricingComparisonModal and does not immediately open or navigate to an external/full payment page.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "change the behavior (open modal instead of full payment page)"
        ]
      },
      "acceptanceCriteria": [
        "Clicking any upgrade CTA keeps the user on the current page and opens the in-app pricing modal (Dialog) instead of navigating away.",
        "No upgrade CTA directly calls the Razorpay initiation function on first click; it only opens the PricingComparisonModal.",
        "The browser URL is not redirected to any Razorpay/checkout URL as a result of the initial upgrade click."
      ]
    },
    {
      "id": "REQ-95",
      "text": "Update PricingComparisonModal so plan upgrade buttons do not immediately initiate Razorpay checkout. Instead, the modal must present an in-modal confirmation step (or secondary button) that the user explicitly clicks to proceed to payment, keeping the user in the app modal flow until they confirm.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "change the behavior (open modal instead of full payment page)"
        ]
      },
      "acceptanceCriteria": [
        "Inside PricingComparisonModal, clicking “Upgrade to Pro/Creator” first shows a clear in-modal confirmation UI (still within the app) and does not open Razorpay immediately.",
        "Only after the user clicks a “Proceed to payment” (or equivalent) control inside the modal should the Razorpay flow be initiated.",
        "Closing/cancelling the confirmation step returns to the pricing modal content without navigating away from the app."
      ]
    },
    {
      "id": "REQ-96",
      "text": "Ensure the Razorpay upgrade initiation (useRazorpayUpgrade) never performs a full-page navigation/redirect as part of the client flow; if checkout cannot be opened as an in-context experience, show a clear English error toast explaining that payment could not be started and to try again later, without leaving the app.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "change the behavior (open modal instead of full payment page)"
        ]
      },
      "acceptanceCriteria": [
        "Initiating payment does not change window.location or navigate the SPA to a new page.",
        "If Razorpay cannot open (SDK missing/not loaded/config missing), the app shows an English toast error and remains usable.",
        "The existing payment-configuration missing message remains English and actionable."
      ]
    }
  ],
  "constraints": [
    "Do not edit files under frontend/src/hooks/useInternetIdentity.ts, frontend/src/hooks/useInternetIdentity.tsx, or frontend/src/hooks/useActor.ts (immutable paths).",
    "Keep the app as a single-page React app; do not add Next.js-style routing/pages.",
    "All user-facing text must be in English."
  ],
  "nonGoals": [
    "Implementing server-side Razorpay order creation, webhook verification, or backend subscription activation logic.",
    "Adding new payment providers or external databases.",
    "Changing plan definitions/entitlements beyond what is needed to support the modal-first upgrade behavior."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}