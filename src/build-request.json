{
  "kind": "build_request",
  "title": "Add prompt-based AI Creative Card Studio mode with multi-event card generation, 3 variations, editing, and premium export rules",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Add a new creation mode called \"Create Card With AI Prompt\" that lets users enter a freeform natural-language prompt to generate a card/invitation, while keeping the existing quick form-based birthday generator as a separate \"Quick Form Mode\".",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Keep BOTH systems:\n\nðŸ‘‰ Quick Form Mode (Fast users)\nðŸ‘‰ Prompt Mode (Creative users)\n\nRename feature to:\n\nðŸ‘‰ \"Create Card With AI Prompt\""
        ]
      },
      "acceptanceCriteria": [
        "The create section offers a clear toggle/segmented control between \"Quick Form Mode\" and \"Create Card With AI Prompt\".",
        "Quick Form Mode retains the current form UX and continues to generate the existing birthday pack outputs without regressions.",
        "Prompt Mode presents a single main prompt input and does not require the birthday-specific fields (name/tone/relationship/etc.) to generate a result."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Implement a Prompt Mode input UI with a main textbox placeholder \"Describe your card or invitation idea...\" and a row/grid of clickable example prompts that prefill the textbox.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Add a main input box:\n\nPlaceholder:\n\"Describe your card or invitation idea...\"\n\nExample prompts displayed below input:\nâ€¢ Luxury birthday invitation for 50th birthday\nâ€¢ Cute baby shower invitation\nâ€¢ Romantic anniversary wish card\nâ€¢ Elegant wedding invitation"
        ]
      },
      "acceptanceCriteria": [
        "Prompt Mode shows the placeholder text exactly: \"Describe your card or invitation idea...\".",
        "At least the 4 provided example prompts are visible and clickable; clicking an example fills the prompt box.",
        "The Generate action is disabled or shows validation until the prompt contains non-whitespace text."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Create a prompt analysis step (rule-based, deterministic) that extracts and stores: event type, tone, visual theme keywords, and layout style from the user prompt, and display the detected values in the UI before/with the results.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "AI analyses prompt and detects:\n\nâœ” Event type\nâœ” Tone\nâœ” Theme\nâœ” Layout style\nâœ” Message format\n\nSystem must automatically detect:\n\nâ€¢ Event Type\n(Birthday, Wedding, Anniversary, Party, Corporate, Festival, etc.)\n\nâ€¢ Tone\n(Formal, Romantic, Emotional, Fun, Luxury, Cute)\n\nâ€¢ Visual Theme\n(Floral, Royal, Minimal, Modern, Cartoon, Elegant, etc.)\n\nâ€¢ Layout Style\n(Invitation layout, Greeting card layout, Poster layout)"
        ]
      },
      "acceptanceCriteria": [
        "Given prompts containing obvious keywords (e.g., \"wedding\", \"baby shower\", \"corporate\", \"festival\", \"luxury\", \"cute\", \"formal\"), the app consistently detects and surfaces matching event type/tone/theme/layout values.",
        "If the prompt is ambiguous, the app chooses sensible defaults and clearly labels them as selected values (not blank).",
        "Detected values are stored in app state and used downstream by card text generation and theme selection."
      ]
    },
    {
      "id": "REQ-4",
      "text": "Generate smart, structured card content from the prompt analysis output, including: (1) title/headline, (2) short readable main message, (3) signature/footer text, and ensure the content is sanitized to avoid instruction-like text.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "AI must generate:\n\nâœ” Professional message content\nâœ” Structured card text hierarchy\nâœ” Short readable message\nâœ” Signature or footer text"
        ]
      },
      "acceptanceCriteria": [
        "Prompt Mode generation produces a title, message, and footer fields for every result.",
        "Generated text is short enough to render on a square card without overflow using existing fit/wrap rules (no clipped text).",
        "Instruction-like content (e.g., \"Prompt:\", \"Instructions:\", \"Generate\") is removed from rendered card text.",
        "The footer uses consistent branding (e.g., WishMint branding) across variations."
      ]
    },
    {
      "id": "REQ-5",
      "text": "Update the card export/preview text formatting logic so it is not hardcoded to birthdays (e.g., remove forced \"Happy Birthday â€¦\" title) and instead uses the analyzed event type + tone to produce an appropriate title/headline and footer for multiple event types (Birthday, Wedding, Anniversary, Party, Corporate, Festival, Graduation, Baby Shower, Love cards).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Not just birthday.\n\nYou Can Support All Card Types\n\nBirthday, Wedding Invitations, Party Invitations, Baby Shower, Love Cards, Graduation, Festival Wishes, Corporate Invitations, Anniversary"
        ]
      },
      "acceptanceCriteria": [
        "For a wedding prompt, the card title/headline is wedding-appropriate (not birthday-specific).",
        "For a corporate invitation prompt, the title/headline and wording are corporate-appropriate (not romantic/birthday).",
        "No user flow in Prompt Mode produces a card preview that contains the literal phrase \"Happy Birthday\" unless the analyzed event type is Birthday."
      ]
    },
    {
      "id": "REQ-6",
      "text": "Ensure Prompt Mode renders 3 unique card design variations per generation, with different layout compositions and different typography/color treatments, while obeying strict layout rules: Title section, decorative focus element, short message, footer branding; prevent text overlap/clutter.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "AI generates:\n\nâ€¢ Wish text\nâ€¢ Card design\nâ€¢ 3 variations\n\nCards must follow strict layout rules:\n\nâ€¢ Title Section\nâ€¢ Decorative Focus Element\nâ€¢ Short Emotional Message\nâ€¢ Footer Branding\n\nPrevent text overlap or clutter.\n\nGenerate:\n\nâ€¢ 3 unique design variations\nâ€¢ Different layout compositions\nâ€¢ Different typography and color treatments"
        ]
      },
      "acceptanceCriteria": [
        "Exactly 3 variations are generated and viewable (e.g., in the existing carousel) for each Prompt Mode generation.",
        "Variations differ in composition and appearance beyond just minor decoration offsets (e.g., at least one of: layout variant, typography pairing, color treatment).",
        "No variation renders overlapping title/message/footer; text remains within safe bounds on 1080Ã—1080 output.",
        "Variations preserve the same semantic content hierarchy (title/message/footer) for a given generation."
      ]
    },
    {
      "id": "REQ-7",
      "text": "Add event-adaptive visual theming so decorations and background/ornament choices change based on detected event type (Birthday â†’ balloons/confetti/cake feel; Wedding â†’ floral/gold/elegant ornaments; Corporate â†’ minimal/modern; Baby Shower â†’ cute/pastel).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "EVENT ADAPTIVE THEMES\n\nAutomatically select decorations based on event type:\n\nBirthday â†’ Balloons, confetti, cake\nWedding â†’ Floral, gold, elegant ornaments\nCorporate â†’ Minimal modern layouts\nBaby Shower â†’ Cute pastel illustrations"
        ]
      },
      "acceptanceCriteria": [
        "When the detected event type changes, the default selected card theme/decoration style changes accordingly without requiring manual selection.",
        "At least the four event mappings listed (Birthday, Wedding, Corporate, Baby Shower) produce visibly different decoration/background treatments in the preview.",
        "Users can still manually override the selected theme after auto-selection."
      ]
    },
    {
      "id": "REQ-8",
      "text": "Add user edit controls for Prompt Mode results: edit generated text fields (title/message/footer), switch theme, change tone, and regenerate designs (keeping the prompt visible/editable).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "USER EDIT CONTROLS\n\nAllow users to:\n\nâ€¢ Edit generated text\nâ€¢ Switch themes\nâ€¢ Change tone\nâ€¢ Regenerate design"
        ]
      },
      "acceptanceCriteria": [
        "Users can edit the generated text and immediately see the preview/variations update (or regenerate variations from the edited text).",
        "Users can change tone via a control; the system re-generates text (and/or styling) consistent with the new tone.",
        "A \"Regenerate\" action produces a fresh set of 3 variations for the same prompt (without requiring retyping).",
        "Theme switching continues to work as it does today, but applies to Prompt Mode outputs as well."
      ]
    },
    {
      "id": "REQ-9",
      "text": "Apply premium export rules to Prompt Mode downloads: Free users get limited-resolution export and/or watermark; Premium users get HD export and watermark removal, reusing the existing entitlements model.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "PREMIUM UPGRADE SYSTEM\n\nFree users:\nâ€¢ Limited resolution\nâ€¢ Watermark\n\nPremium users:\nâ€¢ HD export\nâ€¢ Extra templates\nâ€¢ Video invitation option\nâ€¢ Voice message card option"
        ]
      },
      "acceptanceCriteria": [
        "If the user is not entitled to HD export, the downloaded image is limited-resolution and includes a visible watermark.",
        "If the user is entitled to HD export, the downloaded image is 1080Ã—1080 (or higher if already supported) and contains no watermark.",
        "If the user is anonymous/demo, downloading still requires sign-in (existing behavior preserved).",
        "Premium gating uses the existing plan entitlements (no new auth system)."
      ]
    },
    {
      "id": "REQ-10",
      "text": "Add UI placeholders for \"Video invitation option\" and \"Voice message card option\" in the premium area as Coming Soon items gated behind premium (do not implement real video/voice capture or playback).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Premium users:\nâ€¢ Video invitation option\nâ€¢ Voice message card option"
        ]
      },
      "acceptanceCriteria": [
        "The UI shows \"Video invitation\" and \"Voice message\" as premium/coming-soon capabilities without broken links or dead-end flows.",
        "Clicking these items explains they are coming soon and does not attempt to access microphone/camera or upload media."
      ]
    },
    {
      "id": "REQ-11",
      "text": "Update the Output section copy and structure for Prompt Mode so it is not birthday-pack specific (e.g., replace headings like \"Your Birthday Pack\" with a neutral multi-event label when Prompt Mode is used), while preserving the existing birthday-pack presentation for Quick Form Mode.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Allow users to type natural language prompts and automatically generate professional invitation and wish cards for multiple event types."
        ]
      },
      "acceptanceCriteria": [
        "When outputs are generated via Prompt Mode, the Output section uses neutral language (e.g., \"Your Card\" / \"Your Invitation\") and does not label the result as birthday-only.",
        "When outputs are generated via Quick Form Mode, the Output section continues to display the existing birthday pack labels and behavior.",
        "Switching modes and generating in each mode shows the correct corresponding output framing without stale text from the other mode."
      ]
    }
  ],
  "constraints": [
    "Frontend must not edit files under frontend/src/components/ui or any paths listed as immutable in SYSTEM_CONTEXT.",
    "Backend must remain a single Motoko actor in backend/main.mo; only add migration.mo if persistent state schema must change.",
    "Do not integrate external AI/LLM services (no OpenAI/Anthropic/etc.); implement prompt analysis and content generation locally/rule-based.",
    "Use English for any user-facing text."
  ],
  "nonGoals": [
    "Building or integrating a real AI image generator (e.g., DALLÂ·E-style) for card artwork.",
    "Implementing real-time collaboration, chat, or WebSocket-based features.",
    "Implementing actual video invitation rendering/export, or voice recording/storage/playback (only Coming Soon UI in this iteration).",
    "Adding third-party authentication providers beyond Internet Identity."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}